# ğŸš¤ Kouei - AIç«¶è‰‡äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ 

[![CI/CD](https://github.com/user/kouei/workflows/CI/CD%20Pipeline/badge.svg)](https://github.com/user/kouei/actions)
[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

AIã‚’æ´»ç”¨ã—ãŸç«¶è‰‡ï¼ˆãƒœãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰äºˆæ¸¬ãƒ»åˆ†æã‚·ã‚¹ãƒ†ãƒ ã€‚æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹å‹ç‡äºˆæ¸¬ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚ªãƒƒã‚ºåˆ†æã€è‡ªå‹•ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°æœ€é©åŒ–ãªã©ã®æ©Ÿèƒ½ã‚’æä¾›ã€‚

## ğŸ”§ æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (v3.0.0) ã®å¤‰æ›´ç‚¹

- **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼APIæ§‹é€ **: æ©Ÿèƒ½åˆ¥ã«åˆ†é›¢ã•ã‚ŒãŸæ–°ã—ã„APIã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: çµ±åˆã•ã‚ŒãŸãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†
- **WebSocketé€šçŸ¥**: ãƒ¬ãƒ¼ã‚¹é–‹å§‹ãƒ»çµæœã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
- **ã‚¹ãƒŠã‚¤ãƒ‘ãƒ¼æ©Ÿèƒ½**: ãƒ¬ãƒ¼ã‚¹ç›´å‰ã®é«˜ç²¾åº¦äºˆæ¸¬

## âœ¨ ä¸»ãªæ©Ÿèƒ½

### äºˆæ¸¬ãƒ»åˆ†æ
- **ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«äºˆæ¸¬**: LightGBM, XGBoost, CatBoostã®çµ±åˆãƒ¢ãƒ‡ãƒ«
- **ONNXé«˜é€Ÿæ¨è«–**: 2-3å€é«˜é€Ÿãªäºˆæ¸¬
- **ç›¸æ€§ãƒãƒˆãƒªã‚¯ã‚¹åˆ†æ**: é¸æ‰‹Ã—ãƒ¢ãƒ¼ã‚¿ãƒ¼Ã—ã‚³ãƒ¼ã‚¹ã®3æ¬¡å…ƒåˆ†æ
- **æ°—è±¡äºˆæ¸¬çµ±åˆ**: é¢¨å‘ããƒ»æ½®ä½ã®å½±éŸ¿åˆ†æ

### ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°æœ€é©åŒ–
- **KellyåŸºæº–**: æœ€é©ãªè³­ã‘é‡‘è¨ˆç®—
- **ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–**: æœŸå¾…å€¤ãƒ™ãƒ¼ã‚¹ã®è¤‡åˆè²·ã„æ¨å¥¨
- **ãƒœãƒƒã‚¯ã‚¹è²·ã„ææ¡ˆ**: æœ€é©ãªãƒœãƒƒã‚¯ã‚¹çµ„ã¿åˆã‚ã›

### UI/UX
- **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ**: ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
- **PWAå¯¾å¿œ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é–²è¦§ãƒ»ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: WebSocketå¯¾å¿œ
- **AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥**: è‡ªç„¶è¨€èªã§ã®è³ªå•å¯¾å¿œ

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦è¨­å®š
```

### ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ
```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# APIã‚µãƒ¼ãƒãƒ¼èµ·å‹• (æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼æ§‹é€ )
python -m uvicorn src.api.main_api_new:app --reload --port 8000

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
cd web-ui && npm install && npm run dev
```

### Dockerå®Ÿè¡Œ
```bash
docker-compose up -d
```

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
kouei/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/           # FastAPI ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ main_api_new.py  # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼ˆæ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼æ§‹é€ ï¼‰
â”‚   â”‚   â”œâ”€â”€ routers/         # æ©Ÿèƒ½åˆ¥ãƒ«ãƒ¼ã‚¿ãƒ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ prediction.py # äºˆæ¸¬ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ races.py      # ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.py   # åˆ†æã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ betting.py    # ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ portfolio.py  # ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ system.py     # ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ sync.py       # åŒæœŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ dependencies.py   # ä¾å­˜æ€§æ³¨å…¥
â”‚   â”œâ”€â”€ model/         # ML ãƒ¢ãƒ‡ãƒ« (LightGBM, XGBoost, CatBoost, ONNX)
â”‚   â”œâ”€â”€ features/      # ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
â”‚   â”œâ”€â”€ collector/     # ãƒ‡ãƒ¼ã‚¿åé›† (éåŒæœŸå¯¾å¿œ)
â”‚   â”œâ”€â”€ analysis/      # åˆ†æãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ portfolio/     # ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°æœ€é©åŒ–
â”‚   â”œâ”€â”€ inference/     # æ¨è«–ãƒ»è§£èª¬ç”Ÿæˆ
â”‚   â”œâ”€â”€ config/        # è¨­å®šç®¡ç†
â”‚   â””â”€â”€ utils/         # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ web-ui/            # React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ tests/             # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ models/            # å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ data/              # ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â””â”€â”€ config/            # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ”§ è¨­å®š

### ç’°å¢ƒå¤‰æ•° (.env)

| å¤‰æ•°å | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|--------|------|-----------|
| `API_PORT` | APIã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆ | 8000 |
| `REDIS_HOST` | Redisãƒ›ã‚¹ãƒˆ | localhost |
| `USE_ONNX` | ONNXæ¨è«–ã‚’ä½¿ç”¨ | true |
| `DISCORD_WEBHOOK_URL` | Discordé€šçŸ¥URL | - |
| `LLM_PROVIDER` | LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ (openai/anthropic/none) | none |

## ğŸ“Š API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ã‚·ã‚¹ãƒ†ãƒ 
- `GET /` - APIãƒ«ãƒ¼ãƒˆ
- `GET /health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- `GET /api/status` - ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹

### ãƒ¬ãƒ¼ã‚¹æƒ…å ±
- `GET /api/stadiums` - ç«¶æŠ€å ´ä¸€è¦§
- `GET /api/races` - ãƒ¬ãƒ¼ã‚¹æƒ…å ±
- `GET /api/today` - æœ¬æ—¥ã®ãƒ¬ãƒ¼ã‚¹

### äºˆæ¸¬
- `GET /api/prediction` - ãƒ¬ãƒ¼ã‚¹äºˆæ¸¬
- `GET /api/similar-races` - é¡ä¼¼ãƒ¬ãƒ¼ã‚¹æ¤œç´¢
- `POST /api/simulate-what-if` - ä»®æƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### åˆ†æ
- `GET /api/racer/{racer_id}` - é¸æ‰‹çµ±è¨ˆ
- `GET /api/compatibility` - ç›¸æ€§åˆ†æ
- `GET /api/stadium-matrix/{stadium}` - ä¼šå ´ãƒãƒˆãƒªã‚¯ã‚¹
- `POST /api/concierge/chat` - AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥

### ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°
- `GET /api/odds` - ã‚ªãƒƒã‚ºæƒ…å ±
- `POST /api/betting/optimize` - æœ€é©åŒ–
- `POST /api/betting/formation` - ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

### ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª
- `GET /api/portfolio` - ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªçŠ¶æ…‹
- `GET /api/simulation` - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- `GET /api/backtest` - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- `GET /api/strategies` - æˆ¦ç•¥ä¸€è¦§

### åŒæœŸ
- `GET /api/sync` - åŒæœŸçŠ¶æ…‹
- `GET /api/config` - è¨­å®šå–å¾—
- `POST /api/config` - è¨­å®šæ›´æ–°

è©³ç´°ã¯ `/docs` (Swagger UI) ã¾ãŸã¯ `/redoc` (ReDoc) ã‚’å‚ç…§ã€‚

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install pytest pytest-cov pytest-asyncio

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/ -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest tests/test_api_routers.py::TestAnalysisEndpoints::test_racer_stats -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pytest tests/ --cov=src --cov-report=html

# E2Eãƒ†ã‚¹ãƒˆ (PlaywrightãŒå¿…è¦)
pip install pytest-playwright
playwright install
pytest tests/e2e/ -v
```

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ğŸ™ è¬è¾

- [LightGBM](https://lightgbm.readthedocs.io/)
- [FastAPI](https://fastapi.tiangolo.com/)
- [React](https://react.dev/)

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

- ãƒ¢ãƒ‡ãƒ«ãƒ‰ãƒªãƒ•ãƒˆæ¤œå‡º: `/api/drift-check`
- ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå±¥æ­´: `/api/backtest/history`
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çŠ¶æ…‹: ãƒ­ã‚°ã¾ãŸã¯WebSocketé€šçŸ¥

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### systemdã‚µãƒ¼ãƒ“ã‚¹è¨­å®š

```ini
# /etc/systemd/system/kouei-api.service
[Unit]
Description=Kouei API Service
After=network.target

[Service]
Type=simple
User=exedev
WorkingDirectory=/home/exedev/Kouei
ExecStart=/home/exedev/Kouei/.venv/bin/uvicorn src.api.main_api_new:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

### nginxãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·è¨­å®š

```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

1. Forkã—ã¦featureãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
2. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
3. ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
4. Pull Requestã‚’ä½œæˆ

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

- Issues: GitHub Issuesã‚’ä½¿ç”¨
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: `/docs` ã¾ãŸã¯ `/redoc`
- ãƒ­ã‚°: `logs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
